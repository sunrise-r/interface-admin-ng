<ng-template #inputDirective let-child>
    <ng-container [iadDynamicField]="child"
                  [inputComponents]="inputComponents"
                  [context]="context"
                  [group]="form"
                  (touched)="onTouched(child)"
                  styleClass="form-row form-row-margin"></ng-container>
</ng-template>
<ng-template [ngIf]="!isNestedForm" [ngIfThen]="dynamicForm" [ngIfElse]="nestedForm"></ng-template>
<ng-template #dynamicForm>
    <form (ngSubmit)="onSubmit()" [formGroup]="form" class="content-flex" autocomplete="off">
        <fieldset class="content-flex" [ngClass]="{'perfect-scrollbar-enabled': enablePerfectScroll}">
            <ng-template [ngIf]="enablePerfectScroll" [ngIfThen]="perfectScrollbarFieldset" [ngIfElse]="fieldset"></ng-template>
        </fieldset>
        <ng-template #submitBtn let-styleClass="styleClass" let-label="label">
            <button [class]="styleClass || 'btn btn-primary'" [disabled]="form.invalid || sending" type="submit">
                <span class="title save">{{label || 'Submit'}}</span>
            </button>
        </ng-template>
        <ng-template #cancelBtn let-styleClass="styleClass" let-label="label">
            <button [class]="styleClass || 'btn'" type="button" (click)="cancel()" [disabled]="sending">
                <span class="title clear">{{label || 'Cancel'}}</span>
            </button>
        </ng-template>
        <ng-template #defaultFormFooter let-cancelBtnTpl="cancelBtnTpl" let-submitBtnTpl="submitBtnTpl" let-form="form">
            <div class="form-submit-buttons">
                <ng-template [ngTemplateOutlet]="cancelBtnTpl"
                             [ngTemplateOutletContext]="{styleClass: cancelBtnStyleClass, label: cancelBtnLabel}"></ng-template>
                <ng-template [ngTemplateOutlet]="submitBtnTpl"
                             [ngTemplateOutletContext]="{styleClass: submitBtnStyleClass, label: submitBtnLabel}"></ng-template>
            </div>
        </ng-template>
        <ng-template [ngTemplateOutlet]="formFooter || defaultFormFooter"
                     [ngTemplateOutletContext]="{cancelBtnTpl: cancelBtn, submitBtnTpl: submitBtn, errors: errors, form: form}"></ng-template>
    </form>
</ng-template>
<ng-template #nestedForm>
    <ng-container [formGroup]="form">
        <ng-template [ngTemplateOutlet]="fieldset"></ng-template>
    </ng-container>
</ng-template>
<ng-template #perfectScrollbarFieldset>
    <perfect-scrollbar
        [config]="{suppressScrollX: true, suppressScrollY: false}"
        [ngStyle]="{'width.%': 100, 'height.%': 100}">
        <ng-template [ngTemplateOutlet]="fieldset"></ng-template>
    </perfect-scrollbar>
</ng-template>
<ng-template #fieldset>
    <ng-template ngFor let-child [ngForOf]="formInputGroup.children">
        <ng-template [ngIf]="child.length === 1" [ngIfThen]="singleColumn" [ngIfElse]="multiColumn"></ng-template>
        <ng-template #singleColumn>
            <ng-template [ngTemplateOutlet]="inputDirective" [ngTemplateOutletContext]="{$implicit: child[0]}"></ng-template>
        </ng-template>
        <ng-template #multiColumn>
            <div class="form-row">
                <div *ngFor="let grandChild of child; let i = index" class="col-12 col-lg-{{calculateColumns(child)}}">
                    <ng-template [ngTemplateOutlet]="inputDirective" [ngTemplateOutletContext]="{$implicit: grandChild}"></ng-template>
                </div>
                <div class="clearfix"></div>
            </div>
        </ng-template>
    </ng-template>
</ng-template>
